

$('#history_popup h2').html('Edited by <%= escape_javascript( User.find_by_id(@ver.whodunnit).try(:name) || "Unknown" ) %> at <%= l(@ver.created_at, format: :civilian) %>');
<%
  diff = if @ver.changeset[:content].present?
    Diffy::Diff.new(@ver.changeset[:content].last, @ver.changeset[:content].first, allow_empty_diff: false, context: 3).to_s(:html)
  else
    if params[:counter] == '0'
      "Initial creation"
    else
      "No change information"
    end
  end
  %>
$('#history_popup p').html('<%= escape_javascript( diff.html_safe ) %>');
$('#history_popup').foundation('reveal', 'open');
